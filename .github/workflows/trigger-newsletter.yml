name: Trigger Newsletter Analytics

on:
  push:
    paths:
      - '.github/workflows/trigger-newsletter.yml'

jobs:
  trigger-newsletter-analytics:
    runs-on: ubuntu-latest
    steps:
    - name: Send Newsletter Performance Report to POOOL
      env:
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
      run: |
        echo "ğŸ“Š Triggering Newsletter Analytics Report..."
        echo "ğŸ¯ Sending to POOOL chat: $TELEGRAM_CHAT_ID"
        
        # Newsletter performance report
        REPORT="ğŸ§ª **TEST RUN** ğŸ“Š *NEARWEEK NEWSLETTER ANALYTICS*
ğŸŸ¢ Status: *EXCEPTIONAL PERFORMANCE*
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“§ *Latest:* ğŸš€NEARWEEK #38 ğŸš€
ğŸ“… *Sent:* 03/01/2022 | 2,401 subscribers

ğŸ“ˆ *PERFORMANCE METRICS:*
â€¢ *Open Rate:* 62.9% ğŸ”¥ğŸ”¥ğŸ”¥ ğŸ“ˆ +84.3%
â€¢ *Click Rate:* 2.4% âš ï¸ ğŸ“‰ -20.4%
â€¢ *Click-to-Open:* 3.9%
â€¢ *Unsubscribes:* 4

ğŸ† *MAJOR WINS:*
ğŸ¯ EXCEPTIONAL 62.9% open rate - 3x industry average!
ğŸš€ Best performing campaign in series history
ğŸ“ˆ Year-end recap format drives massive engagement

âš ï¸ *AREAS FOR IMPROVEMENT:*
ğŸ“‰ Click rate below recent historical average
ğŸ¯ High opens not converting to clicks as expected

ğŸ¯ *IMMEDIATE ACTIONS:*
ğŸ”— Add prominent CTAs in high-open campaigns
ğŸ“Š A/B test content layout optimization
ğŸ’ Include specific NEAR Protocol price/milestone callouts

ğŸ§ª *THIS WEEK'S EXPERIMENTS:*
ğŸ“Š Segment high-openers for premium content
ğŸ¤– Test AI-generated market predictions

ğŸ“Š *VS INDUSTRY BENCHMARKS:*
Open: âœ… 285% ABOVE crypto avg (22%)
Click: âŒ 31% BELOW tech avg (3.5%)

ğŸ’¡ *STRATEGIC INSIGHT:*
Your audience is HIGHLY engaged with NEARWEEK content but needs stronger calls-to-action to drive clicks.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ¤– *UserOwned.AI Newsletter Analytics* | $(date +'%d/%m/%Y')
ğŸ“ˆ Next analysis: Weekly automated (Mondays 9 AM UTC)"
        
        # Send to Telegram POOOL using same method as daily intelligence
        curl -s -X POST "https://api.telegram.org/bot$TELEGRAM_BOT_TOKEN/sendMessage" \
          -H "Content-Type: application/json" \
          -d "{
            \"chat_id\": \"$TELEGRAM_CHAT_ID\",
            \"text\": \"$(echo "$REPORT" | sed 's/"/\\"/g' | tr '\n' ' ')\",
            \"parse_mode\": \"Markdown\"
          }"
        
        if [ $? -eq 0 ]; then
          echo "âœ… Newsletter analytics report sent to POOOL successfully!"
        else
          echo "âŒ Failed to send report"
        fi
