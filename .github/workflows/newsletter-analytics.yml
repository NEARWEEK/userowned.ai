name: Newsletter Performance Analytics

on:
  schedule:
    - cron: '0 9 * * 1'  # Every Monday at 9 AM UTC
  workflow_dispatch:

jobs:
  newsletter-analytics:
    runs-on: ubuntu-latest
    steps:
      - name: Send Newsletter Report to POOOL
        if: ${{ secrets.TELEGRAM_BOT_TOKEN && secrets.TELEGRAM_CHAT_ID }}
        run: |
          echo "ðŸ“Š Sending newsletter analytics to Telegram POOOL..."
          
          # Create newsletter report
          cat > /tmp/newsletter_report.txt << 'EOF'
          ðŸ§ª Newsletter Analytics Test
          ðŸ“Š NEARWEEK Performance:
          â€¢ Open Rate: 62.9% ðŸ”¥ (+84.3%)
          â€¢ Click Rate: 2.4% âš ï¸ (-20.4%)
          â€¢ Subscribers: 2,401
          
          ðŸ† WINS: 3x industry average open rate
          ðŸŽ¯ ACTIONS: Add CTAs, A/B test layout
          ðŸ“Š VS Industry: 285% above crypto avg
          
          ðŸ¤– UserOwned.AI Newsletter Analytics
          EOF
          
          # Send to Telegram using same method as daily-intelligence.yml
          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage" \
            -H "Content-Type: application/json" \
            -d "{
              \"chat_id\": \"${{ secrets.TELEGRAM_CHAT_ID }}\",
              \"text\": \"$(cat /tmp/newsletter_report.txt | sed 's/"/\\"/g' | tr '\n' ' ')\",
              \"parse_mode\": \"HTML\"
            }"
          
          echo "âœ… Posted to Telegram POOOL"
